!function(){"use strict";function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var t=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.$field={element:e,image:e.find("img"),point:e.find(".acfImageMapPoint__point"),input:e.find(".acfImageMapPoint__input")};var i=this.$field.image.attr("data-label");this.$field.selector='[data-name="'.concat(i,'"]'),this.$field.settings={percentage:parseInt(this.$field.image.attr("data-percent-based"))},this.$linkedImage=this._getLinkedImage()}var i,n;return i=t,(n=[{key:"_getLinkedImage",value:function(){for(var e=this.$field.element.siblings(this.$field.selector),t=this.$field.element.parents(".acf-field-repeater");!e.length;){if(!t.length)return console.error("Could not find a match for the linked image"),!1;e=t.siblings(this.$field.selector),t=t.parents(".acf-field-repeater")}return e.find('img[data-name="image"]')}},{key:"_loadImage",value:function(){var e=this.$linkedImage.attr("src");e&&this.$field.image.attr("src",e)}},{key:"_handleClick",value:function(e){var t=this._imageDimensions(),i=t.width,n=t.height,a="".concat(e.offsetX,"px"),s="".concat(e.offsetY,"px");this.$field.settings.percentage&&(a="".concat((parseInt(a)/i*100).toFixed(2),"%"),s="".concat((parseInt(s)/n*100).toFixed(2),"%")),this._movePoint(a,s),this.$field.input.val("".concat(a,",").concat(s)),this.$field.input.change()}},{key:"_movePoint",value:function(e,t){this.$field.point.css("left",e).css("top",t).addClass("isActive")}},{key:"_imageDimensions",value:function(){return{width:this.$field.image.width(),height:this.$field.image.height()}}},{key:"_handleInputChange",value:function(){var e=this.$field.input.val().split(",");if(2===e.length){var t=e[0],i=e[1];isNaN(parseInt(t))||-1===t.indexOf("%")&&-1===t.indexOf("px")||isNaN(parseInt(i))||-1===i.indexOf("%")&&-1===i.indexOf("px")||this._movePoint(t,i)}}},{key:"init",value:function(){this.$linkedImage&&(this._loadImage(),this.$linkedImage.on("load",this._loadImage.bind(this)),this.$field.image.on("click",this._handleClick.bind(this)),this.$field.input.on("change input",this._handleInputChange.bind(this)))}}])&&e(i.prototype,n),t}();function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n,a=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$field={element:t,image:t.find("img"),svg:t.find(".acfImageMapPoly__svg"),input:t.find(".acfImageMapPoly__input"),resetButton:t.find(".acfImageMapPoly__reset"),imageWidthInput:t.find(".acfImageMapPoly__imageWidth"),areaInput:t.find(".acfImageMapPoly__areaInput")};var n,a=this.$field.image.attr("data-label");if(this.$field.selector='[data-name="'.concat(a,'"]'),this.$linkedImage=this._getLinkedImage(),this.pointCoords=[],this.$field.input.val()){var s=parseInt(this.$field.imageWidthInput.val());(n=this.$field.input.val().split(","),2,Array.from({length:Math.ceil(n.length/2)},(function(e,t){return n.slice(2*t,2*t+2)}))).forEach((function(e){var t=parseInt(e[0]),n=parseInt(e[1]),a=i._createPointElement();i.pointCoords.push({imageWidth:s,$el:a,x:t,y:n}),i._movePoint(t,n,a)}))}this.polygon=this._createPolygon()}var t,n;return t=e,(n=[{key:"_createPolygon",value:function(){var e=document.createElementNS("http://www.w3.org/2000/svg","polygon");return e.classList.add("acfImageMapPoly__polygon"),e}},{key:"_getLinkedImage",value:function(){for(var e=this.$field.element.siblings(this.$field.selector),t=this.$field.element.parents(".acf-field-repeater");!e.length;){if(!t.length)return console.error("Could not find a match for the linked image"),!1;e=t.siblings(this.$field.selector),t=t.parents(".acf-field-repeater")}return e.find('img[data-name="image"]')}},{key:"_loadImage",value:function(){var e=this.$linkedImage.attr("src");e&&this.$field.image.attr("src",e)}},{key:"_createPointElement",value:function(){var e=document.createElementNS("http://www.w3.org/2000/svg","circle");return e.classList.add("acfImageMapPoly__point"),e.setAttribute("r","5"),e}},{key:"_updatePolygon",value:function(){var e="";this.pointCoords.forEach((function(t,i){i>0&&(e+=","),e+="".concat(t.x,",").concat(t.y)})),this.polygon.setAttribute("points",e),this.$field.svg.prepend(this.polygon)}},{key:"_handleClick",value:function(e){var t=e.offsetX,i=e.offsetY,n=this._createPointElement();this.pointCoords.push({imageWidth:this._imageDimensions().width,$el:n,x:t,y:i}),this._movePoint(t,i,n),this._update(t,i)}},{key:"recalculate",value:function(){var e=this;if(0!==this.pointCoords.length){var t=this._imageDimensions().width;this.pointCoords.forEach((function(i){i.x=Math.round(i.x*(t/i.imageWidth)),i.y=Math.round(i.y*(t/i.imageWidth)),i.imageWidth=t,e._movePoint(i.x,i.y,i.$el,!1)})),this._update()}}},{key:"_reset",value:function(){this.pointCoords=[],this.$field.svg.empty(),this.$field.input.val(""),this.$field.areaInput.val(""),this.polygon=this._createPolygon()}},{key:"_update",value:function(){this._updatePolygon(),this.$field.input.val(this.polygon.getAttribute("points")),this.$field.imageWidthInput.val(this._imageDimensions().width),this._updateArea()}},{key:"_updateArea",value:function(){var e=this._imageDimensions(),t=e.width,i=e.naturalWidth/t,n=this.polygon.getAttribute("points").split(",");this.$field.areaInput.val(n.map((function(e){return Math.round(e*i)})).join(","))}},{key:"_movePoint",value:function(e,t,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];i.setAttribute("cx",e),i.setAttribute("cy",t),n&&this.$field.svg.append(i)}},{key:"_imageDimensions",value:function(){return{width:this.$field.image.width(),height:this.$field.image.height(),naturalWidth:this.$field.image[0].naturalWidth,naturalHeight:this.$field.image[0].naturalHeight}}},{key:"init",value:function(){this.$linkedImage&&(this._loadImage(),this.$linkedImage.on("load",this._loadImage.bind(this)),this.$field.svg.on("click",this._handleClick.bind(this)),this.$field.resetButton.on("click",this._reset.bind(this)),window.addEventListener("resize",this.recalculate.bind(this)),window.addEventListener("load",this.recalculate.bind(this)))}}])&&i(t.prototype,n),e}();n=jQuery,void 0!==acf.add_action&&acf.add_action("ready append",(function(e){acf.get_fields({type:"image_map"},e).each((function(){1===n(this).find(".acfImageMapPoint").length?new t(n(this)).init():1===n(this).find(".acfImageMapPoly").length&&new a(n(this)).init()}))}))}();